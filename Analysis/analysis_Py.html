<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Replication Analysis: Income Moderates Age-Related Financial Patience</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="analysis_Py_files/libs/clipboard/clipboard.min.js"></script>
<script src="analysis_Py_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="analysis_Py_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="analysis_Py_files/libs/quarto-html/popper.min.js"></script>
<script src="analysis_Py_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analysis_Py_files/libs/quarto-html/anchor.min.js"></script>
<link href="analysis_Py_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analysis_Py_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analysis_Py_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analysis_Py_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analysis_Py_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Replication Analysis: Income Moderates Age-Related Financial Patience</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="a-python-implementation-of-the-findings-from-wan-et-al.-2024-psychology-and-aging" class="level3">
<h3 class="anchored" data-anchor-id="a-python-implementation-of-the-findings-from-wan-et-al.-2024-psychology-and-aging">A Python implementation of the findings from Wan et al.&nbsp;(2024), <em>Psychology and Aging</em></h3>
<hr>
</section>
<section id="objective" class="level3">
<h3 class="anchored" data-anchor-id="objective">Objective</h3>
<p>This notebook provides a complete, reproducible Python workflow for the analyses presented in the following publication:</p>
<blockquote class="blockquote">
<p>Wan, H., Myerson, J., Green, L., Strube, M. J., &amp; Hale, S. (2024). Age-related differences in delay discounting: Income matters. <em>Psychology and Aging</em>. Advance online publication. https://doi.org/10.1037/pag0000818</p>
</blockquote>
<p>The original analysis was conducted in R, and this notebook serves to replicate the findings using the Python data science ecosystem. The project’s goal is to test the <strong>“buffering hypothesis”</strong>—the theory posits that the greater emotional stability of older adults buffers them against the financial stress of scarcity, leading to more patient financial decisions compared to their younger, low-income counterparts.</p>
</section>
<section id="technical-workflow" class="level3">
<h3 class="anchored" data-anchor-id="technical-workflow">Technical Workflow</h3>
<p>The analysis is structured in five sequential stages:</p>
<ol type="1">
<li><strong>Setup &amp; Data Import</strong>: Load required Python libraries (<code>pandas</code>, <code>statsmodels</code>, <code>pymc</code>, etc.) and the raw dataset.</li>
<li><strong>Data Processing &amp; Validation</strong>: Clean the data, create analysis-ready dataframes, and perform data quality and reliability checks.</li>
<li><strong>Hypothesis Testing 1 (Age Effects)</strong>: Replicate the Bayesian multilevel models from Table 2 of the paper, testing the effect of age on financial patience within each income group.</li>
<li><strong>Hypothesis Testing 2 (Income Effects)</strong>: Replicate the models from Table 3, testing the effect of income within each age group.</li>
<li><strong>Composite Score Analysis</strong>: Create a composite z-score to perform final correlation tests and quantify the magnitude of the key interaction effect.</li>
</ol>
<p>The data and original study materials are publicly available on the Open Science Framework at <a href="https://osf.io/um68t/">https://osf.io/um68t/</a>.</p>
<div id="662f0c47" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Environment Setup ---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This cell installs the required Python packages for the analysis.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment and run this cell only if you are setting up a new environment.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># import sys</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># !{sys.executable} -m pip install pandas numpy openpyxl scipy statsmodels pymc arviz scikit-learn</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="3d009214" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. SETUP: IMPORTS, FUNCTIONS, AND DATA PROCESSING ---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1.1 Load Libraries ---</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Core data science libraries</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical modeling and analysis</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymc <span class="im">as</span> pm</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> arviz <span class="im">as</span> az</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> pearsonr</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> curve_fit</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress warnings for a cleaner final report</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set pandas display options for consistent formatting</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1.2 Custom Functions ---</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the mathematical functions for curve fitting</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> logistic_growth(log_k, a, r):</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Logistic growth function used to model MCQ choice proportions."""</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp(<span class="op">-</span>(log_k <span class="op">-</span> a) <span class="op">*</span> r))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hyperboloid(delay, k, s):</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Hyperboloid function used to model delay discounting."""</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> k <span class="op">*</span> delay)<span class="op">**</span>s</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_r2(df, x_col, y_col, model_func, p0):</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Helper function to fit a curve and return R-squared."""</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    params, _ <span class="op">=</span> curve_fit(model_func, df[x_col], df[y_col], p0<span class="op">=</span>p0)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model_func(df[x_col], <span class="op">*</span>params)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2_score(df[y_col], y_pred)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function for Bayesian modeling</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_bayesian_glmm(formula: <span class="bu">str</span>, data: pd.DataFrame, family: <span class="bu">str</span> <span class="op">=</span> <span class="st">'binomial'</span>, progressbar: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">    Fits a Bayesian Generalized Linear Mixed-Effects Model using PyMC.</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">    This function is designed to replicate the brms models from the R analysis,</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">    including a random intercept for participant ID.</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co">        formula (str): A statsmodels-style formula (e.g., "outcome ~ predictor").</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co">        data (pd.DataFrame): The dataframe containing the model variables.</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co">        family (str): The likelihood distribution ('binomial' or 'beta').</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="co">        progressbar (bool): Whether to display the MCMC sampling progress bar.</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">        arviz.InferenceData: The fitted model object containing posterior samples.</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    outcome, predictors <span class="op">=</span> formula.split(<span class="st">'~'</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    outcome <span class="op">=</span> outcome.strip()</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use patsy to parse the formula and create design matrices</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    y, X <span class="op">=</span> pd.factorize(data[<span class="st">'ID'</span>])</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> {<span class="st">"obs_id"</span>: np.arange(data.shape[<span class="dv">0</span>]), <span class="st">"participant"</span>: X}</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    participant_idx <span class="op">=</span> y</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> pm.Model(coords<span class="op">=</span>coords) <span class="im">as</span> model:</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Priors ---</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Priors are chosen to be weakly informative, matching the R brms setup.</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        intercept <span class="op">=</span> pm.Normal(<span class="st">"Intercept"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Assumes a single slope for simplicity in this helper function</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        slope <span class="op">=</span> pm.Normal(predictors.strip(), mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="fl">2.5</span>) </span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Random intercepts for each participant</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        sd_participant <span class="op">=</span> pm.HalfCauchy(<span class="st">"sd_participant"</span>, beta<span class="op">=</span><span class="fl">2.5</span>)</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        z_participant <span class="op">=</span> pm.Normal(<span class="st">"z_participant"</span>, mu<span class="op">=</span><span class="dv">0</span>, sigma<span class="op">=</span><span class="dv">1</span>, dims<span class="op">=</span><span class="st">"participant"</span>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        participant_effect <span class="op">=</span> z_participant <span class="op">*</span> sd_participant</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Linear Model ---</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> (intercept <span class="op">+</span>  slope <span class="op">*</span> data[predictors.strip()] <span class="op">+</span> participant_effect[participant_idx])</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Likelihood ---</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> family <span class="op">==</span> <span class="st">'binomial'</span>:</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>            p <span class="op">=</span> pm.math.invlogit(eta)</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>            pm.Binomial(</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>                outcome,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>                n<span class="op">=</span>data[<span class="st">'trials'</span>].values,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>                p<span class="op">=</span>p,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>                observed<span class="op">=</span>data[outcome].values,</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>                dims<span class="op">=</span><span class="st">"obs_id"</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> family <span class="op">==</span> <span class="st">'beta'</span>:</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For Beta regression, the precision parameter (nu) also needs a prior</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>            nu <span class="op">=</span> pm.HalfCauchy(<span class="st">"nu"</span>, beta<span class="op">=</span><span class="dv">10</span>) </span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>            mu <span class="op">=</span> pm.math.invlogit(eta)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>            pm.Beta(</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>                outcome,</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>                mu<span class="op">=</span>mu,</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>                nu<span class="op">=</span>nu, </span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>                observed<span class="op">=</span>data[outcome].values,</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>                dims<span class="op">=</span><span class="st">"obs_id"</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- MCMC Sampling ---</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        idata <span class="op">=</span> pm.sample(draws<span class="op">=</span><span class="dv">2000</span>, tune<span class="op">=</span><span class="dv">2000</span>, chains<span class="op">=</span><span class="dv">4</span>, cores<span class="op">=</span><span class="dv">4</span>, target_accept<span class="op">=</span><span class="fl">0.95</span>, progressbar<span class="op">=</span>progressbar)</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> idata</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_pymc_model(idata, var_names<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates a clean summary table from a PyMC InferenceData object.</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="co">        idata (arviz.InferenceData): A fitted PyMC model object.</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="co">        var_names (list, optional): List of variable names to include in the summary.</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="co">        pd.DataFrame: A formatted summary table including mean, HDI, and pd.</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    summary_df <span class="op">=</span> az.summary(idata, hdi_prob<span class="op">=</span><span class="fl">0.95</span>, kind<span class="op">=</span><span class="st">'stats'</span>, var_names<span class="op">=</span>var_names)</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Probability of Direction (pd)</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    posterior <span class="op">=</span> az.extract(idata, var_names<span class="op">=</span>var_names)</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    pd_values <span class="op">=</span> {}</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> posterior.data_vars:</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        samples <span class="op">=</span> posterior[var].values.flatten()</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        pd_val <span class="op">=</span> np.mean(samples <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>        pd_val <span class="op">=</span> <span class="bu">max</span>(pd_val, <span class="dv">1</span> <span class="op">-</span> pd_val) <span class="co"># Ensure pd is always &gt;= 0.5</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        pd_values[var] <span class="op">=</span> pd_val</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    summary_df[<span class="st">'pd'</span>] <span class="op">=</span> summary_df.index.<span class="bu">map</span>(pd_values)</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    summary_df[<span class="st">'significance'</span>] <span class="op">=</span> np.where(summary_df[<span class="st">'pd'</span>] <span class="op">&gt;=</span> <span class="fl">0.975</span>, <span class="st">'*'</span>, <span class="st">' '</span>)</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    summary_df <span class="op">=</span> summary_df[[<span class="st">'mean'</span>, <span class="st">'hdi_2.5%'</span>, <span class="st">'hdi_97.5%'</span>, <span class="st">'pd'</span>, <span class="st">'significance'</span>]]</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    summary_df.columns <span class="op">=</span> [<span class="st">'Median'</span>, <span class="st">'CI_lower'</span>, <span class="st">'CI_upper'</span>, <span class="st">'pd'</span>, <span class="st">'sig'</span>]</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> summary_df</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1.3 Load and Process Data ---</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Load raw data from the two sheets in the Excel file</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>raw_mcq_df <span class="op">=</span> pd.read_excel(<span class="st">"Data_AgeIncome.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"MCQ"</span>)</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>raw_adj_amt_df <span class="op">=</span> pd.read_excel(<span class="st">"Data_AgeIncome.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Adj-Amt"</span>)</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a lookup table for MCQ item parameters - a much cleaner approach</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>mcq_item_params <span class="op">=</span> pd.DataFrame({</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Q_ID'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">28</span>),</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    <span class="st">'k'</span>: [<span class="fl">0.00016</span>, <span class="fl">0.006</span>, <span class="fl">0.006</span>, <span class="fl">0.25</span>, <span class="fl">0.041</span>, <span class="fl">0.0004</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.00016</span>, <span class="fl">0.006</span>, </span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.25</span>, <span class="fl">0.001</span>, <span class="fl">0.00016</span>, <span class="fl">0.041</span>, <span class="fl">0.0025</span>, <span class="fl">0.0025</span>, <span class="fl">0.0004</span>, <span class="fl">0.016</span>, <span class="fl">0.1</span>, <span class="fl">0.0004</span>, </span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.016</span>, <span class="fl">0.0025</span>, <span class="fl">0.041</span>, <span class="fl">0.001</span>, <span class="fl">0.016</span>, <span class="fl">0.001</span>, <span class="fl">0.25</span>],</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Amount'</span>: [<span class="st">"$55"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>, <span class="st">"$80"</span>, </span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>               <span class="st">"$55"</span>, <span class="st">"$30"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>, <span class="st">"$80"</span>, <span class="st">"$55"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, </span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>               <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>, <span class="st">"$30"</span>, <span class="st">"$80"</span>, <span class="st">"$55"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>]</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the parameters with the raw MCQ data</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>mcq_df_with_params <span class="op">=</span> pd.merge(raw_mcq_df, mcq_item_params, on<span class="op">=</span><span class="st">'Q_ID'</span>)</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>mcq_df_with_params[<span class="st">'Amount'</span>] <span class="op">=</span> pd.Categorical(</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    mcq_df_with_params[<span class="st">'Amount'</span>], </span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>    categories<span class="op">=</span>[<span class="st">"$80"</span>, <span class="st">"$55"</span>, <span class="st">"$30"</span>], ordered<span class="op">=</span><span class="va">True</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate participant-level summaries for each behavioral task</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>adj_amt_participant_summary <span class="op">=</span> raw_adj_amt_df[raw_adj_amt_df[<span class="st">'Delay'</span>] <span class="op">!=</span> <span class="dv">730</span>].groupby([<span class="st">'ID'</span>, <span class="st">'Amount'</span>]).<span class="bu">apply</span>(</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> g: pd.Series({<span class="st">'auc'</span>: np.trapz(g[<span class="st">'RSV'</span>], g[<span class="st">'Delay'</span>] <span class="op">/</span> g[<span class="st">'Delay'</span>].<span class="bu">max</span>())})</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>mcq_participant_summary <span class="op">=</span> mcq_df_with_params.groupby([<span class="st">'ID'</span>, <span class="st">'Amount'</span>], observed<span class="op">=</span><span class="va">True</span>).agg(</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    num_delayed_choices<span class="op">=</span>(<span class="st">'Choice'</span>, <span class="st">'sum'</span>)</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Create master demographics dataframe and join to behavioral summaries</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>demographics_df <span class="op">=</span> raw_adj_amt_df[[<span class="st">'ID'</span>, <span class="st">'Group'</span>, <span class="st">'Age'</span>, <span class="st">'Gender'</span>, <span class="st">'Education'</span>, <span class="st">'HADS'</span>]].drop_duplicates()</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>demographics_df[<span class="st">'age_group'</span>] <span class="op">=</span> np.where(demographics_df[<span class="st">'Group'</span>].isin([<span class="dv">1</span>, <span class="dv">2</span>]), <span class="dv">0</span>, <span class="dv">1</span>)    <span class="co"># 0=Younger</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>demographics_df[<span class="st">'income_group'</span>] <span class="op">=</span> np.where(demographics_df[<span class="st">'Group'</span>].isin([<span class="dv">1</span>, <span class="dv">3</span>]), <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># 0=Lower</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>demographics_df[<span class="st">'education_group'</span>] <span class="op">=</span> np.where(demographics_df[<span class="st">'Education'</span>] <span class="op">&lt;=</span> <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>demographics_df[<span class="st">'hads_score'</span>] <span class="op">=</span> pd.to_numeric(demographics_df[<span class="st">'HADS'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>mcq_analysis_df <span class="op">=</span> pd.merge(mcq_participant_summary, demographics_df, on<span class="op">=</span><span class="st">'ID'</span>)</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>adj_amt_analysis_df <span class="op">=</span> pd.merge(adj_amt_participant_summary, demographics_df, on<span class="op">=</span><span class="st">'ID'</span>)</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a><span class="co"># Create model-specific dataframes with centered variables</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_centered_predictors(df, cols):</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    df_copy <span class="op">=</span> df.copy()</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> cols:</span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>        df_copy[<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">_c'</span>] <span class="op">=</span> df_copy[col] <span class="op">-</span> df_copy[col].mean()</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_copy</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>mcq_model1_df <span class="op">=</span> mcq_analysis_df[mcq_analysis_df[<span class="st">'Amount'</span>].isin([<span class="st">"$30"</span>, <span class="st">"$80"</span>])]</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>mcq_model1_df <span class="op">=</span> add_centered_predictors(mcq_model1_df, [<span class="st">'age_group'</span>, <span class="st">'income_group'</span>])</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>mcq_model1_df[<span class="st">'trials'</span>] <span class="op">=</span> <span class="dv">9</span> <span class="co"># Number of choices per block</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>adj_amt_model1_df <span class="op">=</span> adj_amt_analysis_df[adj_amt_analysis_df[<span class="st">'Amount'</span>].isin([<span class="dv">30</span>, <span class="dv">80</span>])]</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>adj_amt_model1_df <span class="op">=</span> add_centered_predictors(adj_amt_model1_df, [<span class="st">'age_group'</span>, <span class="st">'income_group'</span>])</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the composite z-score dataframe</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>mcq_z <span class="op">=</span> mcq_analysis_df[mcq_analysis_df[<span class="st">'Amount'</span>].isin([<span class="st">"$30"</span>, <span class="st">"$80"</span>])].sort_values([<span class="st">'ID'</span>, <span class="st">'Amount'</span>], ascending<span class="op">=</span>[<span class="va">True</span>, <span class="va">False</span>])</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>adj_z <span class="op">=</span> adj_amt_analysis_df[adj_amt_analysis_df[<span class="st">'Amount'</span>].isin([<span class="dv">30</span>, <span class="dv">80</span>])]</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>composite_score_df <span class="op">=</span> mcq_z[[<span class="st">'ID'</span>, <span class="st">'age_group'</span>, <span class="st">'income_group'</span>, <span class="st">'Age'</span>, <span class="st">'num_delayed_choices'</span>]].copy()</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>composite_score_df[<span class="st">'auc'</span>] <span class="op">=</span> adj_z[<span class="st">'auc'</span>].values</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>composite_score_df[<span class="st">'mcq_z'</span>] <span class="op">=</span> (composite_score_df[<span class="st">'num_delayed_choices'</span>] <span class="op">-</span> composite_score_df[<span class="st">'num_delayed_choices'</span>].mean()) <span class="op">/</span> composite_score_df[<span class="st">'num_delayed_choices'</span>].std()</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>composite_score_df[<span class="st">'adj_amt_z'</span>] <span class="op">=</span> (composite_score_df[<span class="st">'auc'</span>] <span class="op">-</span> composite_score_df[<span class="st">'auc'</span>].mean()) <span class="op">/</span> composite_score_df[<span class="st">'auc'</span>].std()</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>composite_score_df[<span class="st">'mean_z_score'</span>] <span class="op">=</span> composite_score_df[[<span class="st">'mcq_z'</span>, <span class="st">'adj_amt_z'</span>]].mean(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>composite_score_df <span class="op">=</span> composite_score_df.groupby(<span class="st">'ID'</span>).mean().reset_index() <span class="co"># Average z-score per participant</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>composite_score_df <span class="op">=</span> add_centered_predictors(composite_score_df, [<span class="st">'age_group'</span>, <span class="st">'income_group'</span>])</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>composite_score_df[<span class="st">'age_c'</span>] <span class="op">=</span> (composite_score_df[<span class="st">'Age'</span>] <span class="op">-</span> composite_score_df[<span class="st">'Age'</span>].mean()) <span class="op">/</span> composite_score_df[<span class="st">'Age'</span>].std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-quality-reliability-checks" class="level2">
<h2 class="anchored" data-anchor-id="data-quality-reliability-checks">2. Data Quality &amp; Reliability Checks</h2>
<p>Before testing the primary hypotheses, this section replicates the initial analyses from the paper that establish the quality and internal consistency of the behavioral data. These checks confirm two key points:</p>
<ol type="1">
<li><strong>Validity Check</strong>: We fit established mathematical models of choice behavior (a logistic growth function for MCQ data and a hyperboloid function for Adj-Amt data) to the group-level data. R-squared values indicate that participants’ choices were systematic and not random, conforming to theoretical expectations.</li>
<li><strong>Reliability Check</strong>: We assess the internal consistency of our measures by correlating participants’ scores across the different reward amounts within each task. High positive correlations demonstrate that the tasks are reliable; for example, a participant who was impatient for a small reward was also likely to be impatient for a large one.</li>
</ol>
<div id="908578b3" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2.1 Group-Level Model Fit Assessment ---</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The following analyses assess how well standard mathematical models of choice</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># describe the aggregated data from each of the four participant groups.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># High R-squared values indicate that the data is well-behaved and systematic.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Create aggregated dataframes for group-level analysis ---</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>group_labels <span class="op">=</span> {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: <span class="st">"Younger, Lower-Income"</span>, <span class="dv">2</span>: <span class="st">"Younger, Higher-Income"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: <span class="st">"Older, Lower-Income"</span>, <span class="dv">4</span>: <span class="st">"Older, Higher-Income"</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>mcq_df_with_params[<span class="st">'group_label'</span>] <span class="op">=</span> mcq_df_with_params[<span class="st">'Group'</span>].<span class="bu">map</span>(group_labels)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>raw_adj_amt_df[<span class="st">'group_label'</span>] <span class="op">=</span> raw_adj_amt_df[<span class="st">'Group'</span>].<span class="bu">map</span>(group_labels)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>mcq_group_summary <span class="op">=</span> mcq_df_with_params.groupby([<span class="st">'group_label'</span>, <span class="st">'Amount'</span>, <span class="st">'k'</span>], observed<span class="op">=</span><span class="va">True</span>).agg(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    prop_delayed<span class="op">=</span>(<span class="st">'Choice'</span>, <span class="st">'mean'</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>mcq_group_summary[<span class="st">'log_k'</span>] <span class="op">=</span> np.log(mcq_group_summary[<span class="st">'k'</span>])</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>adj_amt_group_summary <span class="op">=</span> raw_adj_amt_df.groupby([<span class="st">'group_label'</span>, <span class="st">'Amount'</span>, <span class="st">'Delay'</span>]).agg(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    mean_rsv<span class="op">=</span>(<span class="st">'RSV'</span>, <span class="st">'mean'</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Fit models and calculate R-squared ---</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- MCQ: R-squared for Group-Level Logistic Growth Fits ---"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>r2_mcq <span class="op">=</span> mcq_group_summary.groupby([<span class="st">'group_label'</span>, <span class="st">'Amount'</span>], observed<span class="op">=</span><span class="va">True</span>).<span class="bu">apply</span>(</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    calculate_r2, x_col<span class="op">=</span><span class="st">'log_k'</span>, y_col<span class="op">=</span><span class="st">'prop_delayed'</span>, model_func<span class="op">=</span>logistic_growth, p0<span class="op">=</span>[<span class="op">-</span><span class="dv">4</span>, <span class="dv">1</span>]</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>).unstack()</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_mcq)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Adj-Amt: R-squared for Group-Level Hyperboloid Fits ---"</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>r2_adj_amt <span class="op">=</span> adj_amt_group_summary.groupby([<span class="st">'group_label'</span>, <span class="st">'Amount'</span>]).<span class="bu">apply</span>(</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    calculate_r2, x_col<span class="op">=</span><span class="st">'Delay'</span>, y_col<span class="op">=</span><span class="st">'mean_rsv'</span>, model_func<span class="op">=</span>hyperboloid, p0<span class="op">=</span>[<span class="fl">0.1</span>, <span class="dv">1</span>]</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>).unstack()</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_adj_amt)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2.2 Within-Procedure Reliability (Alternate-Forms Reliability) ---</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co"># These analyses check if participants' discounting rates are consistent across</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co"># different reward amounts within the same procedure.</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- MCQ: Within-Procedure Correlations (Number of Delayed Choices) ---"</span>)</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>mcq_reliability_pivot <span class="op">=</span> mcq_participant_summary.pivot(</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'ID'</span>, columns<span class="op">=</span><span class="st">'Amount'</span>, values<span class="op">=</span><span class="st">'num_delayed_choices'</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mcq_reliability_pivot.corr())</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Adj-Amt: Within-Procedure Correlations (AuC) ---"</span>)</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>adj_amt_reliability_pivot <span class="op">=</span> adj_amt_participant_summary.pivot(</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'ID'</span>, columns<span class="op">=</span><span class="st">'Amount'</span>, values<span class="op">=</span><span class="st">'auc'</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns for clarity in the correlation matrix</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>adj_amt_reliability_pivot.columns <span class="op">=</span> [<span class="ss">f"$</span><span class="sc">{</span>c<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> c <span class="kw">in</span> adj_amt_reliability_pivot.columns]</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(adj_amt_reliability_pivot.corr())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- MCQ: R-squared for Group-Level Logistic Growth Fits ---
Amount                   $80   $55   $30
group_label                             
Older, Higher-Income   0.983 0.991 0.996
Older, Lower-Income    0.994 0.996 0.996
Younger, Higher-Income 0.993 0.987 0.994
Younger, Lower-Income  0.995 0.991 0.992

--- Adj-Amt: R-squared for Group-Level Hyperboloid Fits ---
Amount                   30    80    500
group_label                             
Older, Higher-Income   0.967 0.951 0.943
Older, Lower-Income    0.944 0.985 0.978
Younger, Higher-Income 0.997 0.988 0.959
Younger, Lower-Income  0.997 0.990 0.974


--- MCQ: Within-Procedure Correlations (Number of Delayed Choices) ---
Amount   $80   $55   $30
Amount                  
$80    1.000 0.940 0.903
$55    0.940 1.000 0.918
$30    0.903 0.918 1.000

--- Adj-Amt: Within-Procedure Correlations (AuC) ---
       $30   $80  $500
$30  1.000 0.907 0.774
$80  0.907 1.000 0.842
$500 0.774 0.842 1.000</code></pre>
</div>
</div>
</section>
<section id="hypothesis-testing-effects-of-age-on-discounting" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-testing-effects-of-age-on-discounting">3. Hypothesis Testing: Effects of Age on Discounting</h2>
<p>This section replicates the core analyses from <strong>Table 2</strong> of the publication, which test the primary prediction of the <strong>buffering hypothesis</strong>. The key prediction is that <strong>age will be associated with more patient decision-making (less discounting), but only for the low-income group</strong>. No significant age effect is expected for the high-income group, as they are not experiencing the same level of financial scarcity.</p>
<p>To test this, we fit a series of Bayesian generalized linear mixed-effects models separately for each income group. The models predict discounting behavior as a function of age group.</p>
<div id="84573f04" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3.1 Model 1: Baseline Effect of Age ---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This analysis tests the main prediction: is there an effect of age on discounting</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for each income group, before controlling for other factors?</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Low-Income Group Analysis ---</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- MODEL 1: AGE EFFECTS (LOW-INCOME GROUP) ---"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data for the low-income group</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>low_income_mcq_df <span class="op">=</span> mcq_model1_df[mcq_model1_df[<span class="st">'income_group'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>low_income_adj_amt_df <span class="op">=</span> adj_amt_model1_df[adj_amt_model1_df[<span class="st">'income_group'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Bayesian models</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>idata_mcq_age_low_inc <span class="op">=</span> fit_bayesian_glmm(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"num_delayed_choices ~ age_group_c"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    low_income_mcq_df,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">'binomial'</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>idata_adj_amt_age_low_inc <span class="op">=</span> fit_bayesian_glmm(</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"auc ~ age_group_c"</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    low_income_adj_amt_df,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">'beta'</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summaries</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">MCQ Results (Low-Income):"</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize_pymc_model(idata_mcq_age_low_inc, var_names<span class="op">=</span>[<span class="st">'Intercept'</span>, <span class="st">'age_group_c'</span>]))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Adj-Amt Results (Low-Income):"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize_pymc_model(idata_adj_amt_age_low_inc, var_names<span class="op">=</span>[<span class="st">'Intercept'</span>, <span class="st">'age_group_c'</span>]))</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co"># --- High-Income Group Analysis ---</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- MODEL 1: AGE EFFECTS (HIGH-INCOME GROUP) ---"</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data for the high-income group</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>high_income_mcq_df <span class="op">=</span> mcq_model1_df[mcq_model1_df[<span class="st">'income_group'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>high_income_adj_amt_df <span class="op">=</span> adj_amt_model1_df[adj_amt_model1_df[<span class="st">'income_group'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Bayesian models</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>idata_mcq_age_high_inc <span class="op">=</span> fit_bayesian_glmm(</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"num_delayed_choices ~ age_group_c"</span>,</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    high_income_mcq_df,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">'binomial'</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>idata_adj_amt_age_high_inc <span class="op">=</span> fit_bayesian_glmm(</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"auc ~ age_group_c"</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    high_income_adj_amt_df,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">'beta'</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summaries</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">MCQ Results (High-Income):"</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize_pymc_model(idata_mcq_age_high_inc, var_names<span class="op">=</span>[<span class="st">'Intercept'</span>, <span class="st">'age_group_c'</span>]))</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Adj-Amt Results (High-Income):"</span>)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize_pymc_model(idata_adj_amt_age_high_inc, var_names<span class="op">=</span>[<span class="st">'Intercept'</span>, <span class="st">'age_group_c'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- MODEL 1: AGE EFFECTS (LOW-INCOME GROUP) ---</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, age_group_c, sd_participant, z_participant]
Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 7 seconds.
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, age_group_c, sd_participant, z_participant, nu]
Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 15 seconds.
Initializing NUTS using jitter+adapt_diag...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
MCQ Results (Low-Income):
             Median  CI_lower  CI_upper    pd sig
Intercept    -0.094    -0.251     0.073 0.872    
age_group_c   0.390     0.085     0.701 0.993   *

Adj-Amt Results (Low-Income):
             Median  CI_lower  CI_upper    pd sig
Intercept     0.526     0.345     0.694 1.000   *
age_group_c   0.483     0.138     0.854 0.996   *


--- MODEL 1: AGE EFFECTS (HIGH-INCOME GROUP) ---</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, age_group_c, sd_participant, z_participant]
Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 6 seconds.
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, age_group_c, sd_participant, z_participant, nu]
Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 15 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
MCQ Results (High-Income):
             Median  CI_lower  CI_upper    pd sig
Intercept     0.032    -0.121     0.186 0.660    
age_group_c   0.024    -0.283     0.335 0.566    

Adj-Amt Results (High-Income):
             Median  CI_lower  CI_upper    pd sig
Intercept     0.767     0.606     0.934 1.000   *
age_group_c   0.077    -0.257     0.425 0.675    </code></pre>
</div>
</div>
</section>
<section id="hypothesis-testing-effects-of-income-on-discounting" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-testing-effects-of-income-on-discounting">4. Hypothesis Testing: Effects of Income on Discounting</h2>
<p>This section replicates the complementary analyses from <strong>Table 3</strong> of the publication, providing a second test of the <strong>buffering hypothesis</strong>. The prediction here is the inverse of the previous section: <strong>higher income will be associated with more patient decision-making, but only for the younger group</strong>. Because older adults are already “buffered” by their greater emotional stability, their decision-making should be less influenced by income level.</p>
<p>To test this, we fit a series of Bayesian generalized linear mixed-effects models separately for each age group to examine the effect of income.</p>
<div id="4d41919a" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4.1 Model 1: Baseline Effect of Income ---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This analysis tests the complementary prediction: does higher income lead to</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># less discounting, and is this effect present only for younger adults?</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Younger Adults Analysis ---</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- MODEL 1: INCOME EFFECTS (YOUNGER ADULTS) ---"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data for the younger group</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>younger_mcq_df <span class="op">=</span> mcq_model1_df[mcq_model1_df[<span class="st">'age_group'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>younger_adj_amt_df <span class="op">=</span> adj_amt_model1_df[adj_amt_model1_df[<span class="st">'age_group'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Bayesian models</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>idata_mcq_income_younger <span class="op">=</span> fit_bayesian_glmm(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"num_delayed_choices ~ income_group_c"</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    younger_mcq_df,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">'binomial'</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>idata_adj_amt_income_younger <span class="op">=</span> fit_bayesian_glmm(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"auc ~ income_group_c"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    younger_adj_amt_df,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">'beta'</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summaries</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">MCQ Results (Younger Adults):"</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize_pymc_model(idata_mcq_income_younger, var_names<span class="op">=</span>[<span class="st">'Intercept'</span>, <span class="st">'income_group_c'</span>]))</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Adj-Amt Results (Younger Adults):"</span>)</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize_pymc_model(idata_adj_amt_income_younger, var_names<span class="op">=</span>[<span class="st">'Intercept'</span>, <span class="st">'income_group_c'</span>]))</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Older Adults Analysis ---</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- MODEL 1: INCOME EFFECTS (OLDER ADULTS) ---"</span>)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the data for the older group</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>older_mcq_df <span class="op">=</span> mcq_model1_df[mcq_model1_df[<span class="st">'age_group'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>older_adj_amt_df <span class="op">=</span> adj_amt_model1_df[adj_amt_model1_df[<span class="st">'age_group'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Bayesian models</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>idata_mcq_income_older <span class="op">=</span> fit_bayesian_glmm(</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"num_delayed_choices ~ income_group_c"</span>,</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    older_mcq_df,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">'binomial'</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>idata_adj_amt_income_older <span class="op">=</span> fit_bayesian_glmm(</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"auc ~ income_group_c"</span>,</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    older_adj_amt_df,</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    family<span class="op">=</span><span class="st">'beta'</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Display summaries</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">MCQ Results (Older Adults):"</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize_pymc_model(idata_mcq_income_older, var_names<span class="op">=</span>[<span class="st">'Intercept'</span>, <span class="st">'income_group_c'</span>]))</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Adj-Amt Results (Older Adults):"</span>)</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(summarize_pymc_model(idata_adj_amt_income_older, var_names<span class="op">=</span>[<span class="st">'Intercept'</span>, <span class="st">'income_group_c'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- MODEL 1: INCOME EFFECTS (YOUNGER ADULTS) ---</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, income_group_c, sd_participant, z_participant]
Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 7 seconds.
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, income_group_c, sd_participant, z_participant, nu]
Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 15 seconds.
Initializing NUTS using jitter+adapt_diag...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
MCQ Results (Younger Adults):
                Median  CI_lower  CI_upper    pd sig
Intercept       -0.129    -0.287     0.025 0.947    
income_group_c   0.298     0.003     0.624 0.969    

Adj-Amt Results (Younger Adults):
                Median  CI_lower  CI_upper    pd sig
Intercept        0.515     0.350     0.692 1.000   *
income_group_c   0.427     0.099     0.788 0.994   *


--- MODEL 1: INCOME EFFECTS (OLDER ADULTS) ---</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, income_group_c, sd_participant, z_participant]
Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 6 seconds.
Initializing NUTS using jitter+adapt_diag...
Multiprocess sampling (4 chains in 4 jobs)
NUTS: [Intercept, income_group_c, sd_participant, z_participant, nu]
Sampling 4 chains for 2_000 tune and 2_000 draw iterations (8_000 + 8_000 draws total) took 14 seconds.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
MCQ Results (Older Adults):
                Median  CI_lower  CI_upper    pd sig
Intercept        0.083    -0.077     0.232 0.852    
income_group_c  -0.056    -0.372     0.243 0.635    

Adj-Amt Results (Older Adults):
                Median  CI_lower  CI_upper    pd sig
Intercept        0.794     0.614     0.975 1.000   *
income_group_c   0.033    -0.296     0.397 0.575    </code></pre>
</div>
</div>
</section>
<section id="composite-score-analysis" class="level2">
<h2 class="anchored" data-anchor-id="composite-score-analysis">5. Composite Score Analysis</h2>
<p>The final analyses use the composite z-score—a single, robust measure that combines data from both the MCQ and Adj-Amt procedures—to provide a holistic test of the buffering hypothesis.</p>
<p>First, we replicate the focused correlation tests from the paper. As predicted, we expect to find a significant positive correlation between age and financial patience (higher z-score) <strong>only in the low-income group</strong>. Conversely, we expect a significant positive correlation between income and financial patience <strong>only in the younger group</strong>.</p>
<div id="95bb6610" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5.1 Focused Correlation Tests with Composite Score ---</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the composite z-score to perform the two key hypothesis tests in a </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># single, tidy analysis for each hypothesis.</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 1: Correlation between Age and Discounting within each Income Group</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- Correlation of Age Group with Discounting z-score ---"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>age_correlations <span class="op">=</span> composite_score_df.groupby(<span class="st">'income_group'</span>).<span class="bu">apply</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> df: pearsonr(df[<span class="st">'mean_z_score'</span>], df[<span class="st">'age_group'</span>]),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    include_groups<span class="op">=</span><span class="va">False</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>).<span class="bu">apply</span>(pd.Series)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>age_correlations.columns <span class="op">=</span> [<span class="st">'correlation_r'</span>, <span class="st">'p_value'</span>]</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>age_correlations.index <span class="op">=</span> age_correlations.index.<span class="bu">map</span>({<span class="dv">0</span>: <span class="st">'Low-Income'</span>, <span class="dv">1</span>: <span class="st">'High-Income'</span>})</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(age_correlations)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 2: Correlation between Income and Discounting within each Age Group</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- Correlation of Income Group with Discounting z-score ---"</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>income_correlations <span class="op">=</span> composite_score_df.groupby(<span class="st">'age_group'</span>).<span class="bu">apply</span>(</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> df: pearsonr(df[<span class="st">'mean_z_score'</span>], df[<span class="st">'income_group'</span>]),</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    include_groups<span class="op">=</span><span class="va">False</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>).<span class="bu">apply</span>(pd.Series)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>income_correlations.columns <span class="op">=</span> [<span class="st">'correlation_r'</span>, <span class="st">'p_value'</span>]</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>income_correlations.index <span class="op">=</span> income_correlations.index.<span class="bu">map</span>({<span class="dv">0</span>: <span class="st">'Younger'</span>, <span class="dv">1</span>: <span class="st">'Older'</span>})</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(income_correlations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Correlation of Age Group with Discounting z-score ---
              correlation_r  p_value
income_group                        
Low-Income            0.202    0.007
High-Income           0.041    0.581


--- Correlation of Income Group with Discounting z-score ---
           correlation_r  p_value
age_group                        
Younger            0.163    0.026
Older              0.003    0.964</code></pre>
</div>
</div>
</section>
<section id="quantifying-the-magnitude-of-the-age-difference" class="level2">
<h2 class="anchored" data-anchor-id="quantifying-the-magnitude-of-the-age-difference">6. Quantifying the Magnitude of the Age Difference</h2>
<p>Having established the predicted pattern of effects, these final analyses use the composite z-score to quantify the magnitude of the buffering effect. By fitting a series of linear regression models, we can estimate the practical size of the age-related increase in financial patience specifically for the low-income group. This corresponds to the final results presented in the “Discussion” section of the publication.</p>
<div id="32fc32f3" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6.1 Group Means and Interaction Model ---</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># First, calculate and display the mean composite z-score for each of the four</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># experimental groups to provide context for the regression models.</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"--- Mean Composite z-Score by Group ---"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>mean_z_scores <span class="op">=</span> composite_score_df.groupby([<span class="st">'age_group'</span>, <span class="st">'income_group'</span>])[<span class="st">'mean_z_score'</span>].mean().reset_index()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>mean_z_scores[<span class="st">'Age_Group'</span>] <span class="op">=</span> np.where(mean_z_scores[<span class="st">'age_group'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">"Younger"</span>, <span class="st">"Older"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>mean_z_scores[<span class="st">'Income_Group'</span>] <span class="op">=</span> np.where(mean_z_scores[<span class="st">'income_group'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">"Low-Income"</span>, <span class="st">"High-Income"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mean_z_scores[[<span class="st">'Age_Group'</span>, <span class="st">'Income_Group'</span>, <span class="st">'mean_z_score'</span>]])</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Next, fit a full linear model with an interaction term. This formally tests</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># whether the effect of age on discounting depends on a person's income level.</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- Full Model: z_score ~ Age_Group * Income_Group ---"</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>full_interaction_model <span class="op">=</span> smf.ols(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_z_score ~ age_group_c * income_group_c'</span>, </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>composite_score_df</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(full_interaction_model.summary())</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6.2 Estimating the Continuous Age Effect by Income Group ---</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, model the effect of age as a continuous variable within each</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># income group separately. This allows us to estimate the year-over-year</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co"># change in financial patience (z-score).</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- Continuous Age Effect within Low-Income Group ---"</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># As predicted by the buffering hypothesis, we expect a significant, positive slope for age.</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>low_income_age_model <span class="op">=</span> smf.ols(</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_z_score ~ Age'</span>, </span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>composite_score_df[composite_score_df[<span class="st">'income_group'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(low_income_age_model.summary())</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">--- Continuous Age Effect within High-Income Group ---"</span>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="co"># In the high-income group, we expect the slope for age to be non-significant.</span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>high_income_age_model <span class="op">=</span> smf.ols(</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_z_score ~ Age'</span>, </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>composite_score_df[composite_score_df[<span class="st">'income_group'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(high_income_age_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Mean Composite z-Score by Group ---
  Age_Group Income_Group  mean_z_score
0   Younger   Low-Income        -0.266
1   Younger  High-Income         0.043
2     Older   Low-Income         0.112
3     Older  High-Income         0.118


--- Full Model: z_score ~ Age_Group * Income_Group ---
                            OLS Regression Results                            
==============================================================================
Dep. Variable:           mean_z_score   R-squared:                       0.028
Model:                            OLS   Adj. R-squared:                  0.020
Method:                 Least Squares   F-statistic:                     3.461
Date:                Fri, 31 Oct 2025   Prob (F-statistic):             0.0166
Time:                        15:27:15   Log-Likelihood:                -477.72
No. Observations:                 359   AIC:                             963.4
Df Residuals:                     355   BIC:                             979.0
Df Model:                           3                                         
Covariance Type:            nonrobust                                         
==============================================================================================
                                 coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------------------
Intercept                     -0.0014      0.049     -0.029      0.977      -0.097       0.094
age_group_c                    0.2236      0.097      2.298      0.022       0.032       0.415
income_group_c                 0.1634      0.097      1.681      0.094      -0.028       0.355
age_group_c:income_group_c    -0.3020      0.195     -1.552      0.122      -0.685       0.081
==============================================================================
Omnibus:                        9.668   Durbin-Watson:                   2.151
Prob(Omnibus):                  0.008   Jarque-Bera (JB):                7.126
Skew:                          -0.231   Prob(JB):                       0.0284
Kurtosis:                       2.488   Cond. No.                         4.00
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.


--- Continuous Age Effect within Low-Income Group ---
                            OLS Regression Results                            
==============================================================================
Dep. Variable:           mean_z_score   R-squared:                       0.034
Model:                            OLS   Adj. R-squared:                  0.029
Method:                 Least Squares   F-statistic:                     6.163
Date:                Fri, 31 Oct 2025   Prob (F-statistic):             0.0140
Time:                        15:27:15   Log-Likelihood:                -234.63
No. Observations:                 176   AIC:                             473.3
Df Residuals:                     174   BIC:                             479.6
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -0.7133      0.264     -2.702      0.008      -1.234      -0.192
Age            0.0115      0.005      2.483      0.014       0.002       0.021
==============================================================================
Omnibus:                        2.311   Durbin-Watson:                   2.008
Prob(Omnibus):                  0.315   Jarque-Bera (JB):                1.736
Skew:                          -0.035   Prob(JB):                        0.420
Kurtosis:                       2.518   Cond. No.                         217.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.


--- Continuous Age Effect within High-Income Group ---
                            OLS Regression Results                            
==============================================================================
Dep. Variable:           mean_z_score   R-squared:                       0.002
Model:                            OLS   Adj. R-squared:                 -0.003
Method:                 Least Squares   F-statistic:                    0.4516
Date:                Fri, 31 Oct 2025   Prob (F-statistic):              0.502
Time:                        15:27:15   Log-Likelihood:                -243.62
No. Observations:                 183   AIC:                             491.2
Df Residuals:                     181   BIC:                             497.7
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     -0.0994      0.273     -0.365      0.716      -0.637       0.439
Age            0.0033      0.005      0.672      0.502      -0.006       0.013
==============================================================================
Omnibus:                        7.896   Durbin-Watson:                   2.301
Prob(Omnibus):                  0.019   Jarque-Bera (JB):                7.025
Skew:                          -0.407   Prob(JB):                       0.0298
Kurtosis:                       2.492   Cond. No.                         224.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>