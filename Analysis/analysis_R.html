<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Haoran (Matt) Wan">
<meta name="dcterms.date" content="2025-10-30">

<title>Replication Analysis: Income Moderates Age-Related Financial Patience</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="analysis_R_files/libs/clipboard/clipboard.min.js"></script>
<script src="analysis_R_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="analysis_R_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="analysis_R_files/libs/quarto-html/popper.min.js"></script>
<script src="analysis_R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analysis_R_files/libs/quarto-html/anchor.min.js"></script>
<link href="analysis_R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analysis_R_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analysis_R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analysis_R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analysis_R_files/libs/bootstrap/bootstrap-ad9d882a8d4892f10c75c77a44fc7734.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>


<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#analysis-workflow" id="toc-analysis-workflow" class="nav-link" data-scroll-target="#analysis-workflow">Analysis Workflow</a></li>
  </ul></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing">Data Processing</a></li>
  <li><a href="#data-quality-reliability-checks" id="toc-data-quality-reliability-checks" class="nav-link" data-scroll-target="#data-quality-reliability-checks">3. Data Quality &amp; Reliability Checks</a></li>
  <li><a href="#hypothesis-testing-effects-of-age-on-discounting" id="toc-hypothesis-testing-effects-of-age-on-discounting" class="nav-link" data-scroll-target="#hypothesis-testing-effects-of-age-on-discounting">4. Hypothesis Testing: Effects of Age on Discounting</a></li>
  <li><a href="#hypothesis-testing-effects-of-income-on-discounting" id="toc-hypothesis-testing-effects-of-income-on-discounting" class="nav-link" data-scroll-target="#hypothesis-testing-effects-of-income-on-discounting">5. Hypothesis Testing: Effects of Income on Discounting</a></li>
  <li><a href="#composite-score-analysis-effect-magnitudes" id="toc-composite-score-analysis-effect-magnitudes" class="nav-link" data-scroll-target="#composite-score-analysis-effect-magnitudes">6. Composite Score Analysis &amp; Effect Magnitudes</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Replication Analysis: Income Moderates Age-Related Financial Patience</h1>
<p class="subtitle lead">An R implementation of the findings from Wan et al.&nbsp;(2024), <em>Psychology and Aging</em></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Haoran (Matt) Wan </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 30, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This document provides a complete, reproducible R script for the analyses presented in the following publication:</p>
<blockquote class="blockquote">
<p>Wan, H., Myerson, J., Green, L., Strube, M. J., &amp; Hale, S. (2024). Age-related differences in delay discounting: Income matters. <em>Psychology and Aging</em>. Advance online publication. <a href="https://doi.org/10.1037/pag0000818">https://doi.org/10.1037/pag0000818</a></p>
</blockquote>
<p>The study’s central goal was to test a <strong>“buffering hypothesis”</strong>—the theory that the greater emotional stability associated with older age buffers individuals against the financial stress of scarcity, leading to more patient financial decisions compared to younger adults in the same low-income bracket.</p>
<p>The data and original study materials are publicly available on the Open Science Framework at <a href="https://osf.io/um68t/">https://osf.io/um68t/</a>.</p>
<section id="analysis-workflow" class="level3">
<h3 class="anchored" data-anchor-id="analysis-workflow">Analysis Workflow</h3>
<p>The analysis is structured in five sequential stages:</p>
<ol type="1">
<li><strong>Environment Setup</strong>: Load all required R packages, define custom functions for modeling, and import the raw dataset.</li>
<li><strong>Data Processing &amp; Validation</strong>: Clean the raw data, perform data quality checks, and assess the reliability of the behavioral measures (Monetary Choice Questionnaire and Adjusting-Amount procedure).</li>
<li><strong>Hypothesis Testing 1 (Age Effects)</strong>: Replicate the Bayesian multilevel models from Table 2 of the paper. This involves running focused contrasts to test the effect of age on financial patience within both low- and high-income groups.</li>
<li><strong>Hypothesis Testing 2 (Income Effects)</strong>: Replicate the models from Table 3. These contrasts test the effect of income on financial patience within both younger and older adult groups.</li>
<li><strong>Composite Score Analysis</strong>: Create a composite z-score combining both behavioral measures to verify the primary interaction effect and quantify the magnitude of the age difference in the low-income cohort.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set global chunk options to suppress messages and warnings for a clean output</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">message =</span> <span class="cn">FALSE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">error =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. SETUP: ENVIRONMENT AND HELPER FUNCTIONS ---</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This section prepares the R environment for the analysis. It loads all </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># necessary packages and defines custom functions to streamline the Bayesian </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># modeling and results summarization.</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1.1 Load R Packages ---</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages for data manipulation, modeling, and visualization.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)     <span class="co"># To read data from Excel files</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)      <span class="co"># For data manipulation and wrangling (part of tidyverse)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)      <span class="co"># For tidying data (part of tidyverse)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)    <span class="co"># For string manipulation (part of tidyverse)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)      <span class="co"># For psychological research tools, e.g., composite scores</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)       <span class="co"># For Bayesian Regression Models using Stan</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)  <span class="co"># For tidying and visualizing Bayesian model output</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayestestR) <span class="co"># For computing indices of model fit and posterior summaries</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(minpack.lm) <span class="co"># For nonlinear model fitting</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1.2 Custom Functions ---</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Wrapper for Bayesian Binomial GLMM</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description A helper function to fit a binomial mixed-effects model using brms.</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#'   It pre-sets weakly informative priors and MCMC parameters for consistency.</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param model_formula A brms formula object.</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param dataset The dataframe containing the variables in the formula.</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file_path Optional string to save the fitted model object.</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A fitted brms model object.</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>binomial_brm <span class="ot">&lt;-</span> <span class="cf">function</span>(model_formula, dataset, <span class="at">file_path =</span> <span class="cn">NULL</span>) {</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> model_formula, </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(), <span class="co"># Specifies a logistic link function for binary outcome data</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dataset, </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set weakly informative priors as described in the paper</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept), </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> sd)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">4000</span>,      <span class="co"># Total MCMC iterations per chain</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">warmup =</span> <span class="dv">2000</span>,    <span class="co"># Burn-in iterations to discard</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>,       <span class="co"># Number of independent Markov chains</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">4</span>,        <span class="co"># Number of CPU cores to use for parallel execution</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">"cmdstanr"</span>, <span class="co"># Use the fast cmdstanr backend</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>, <span class="at">max_treedepth =</span> <span class="dv">10</span>), <span class="co"># MCMC convergence settings</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> file_path, <span class="co"># Cache the model fit to save time on re-runs</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span>,      <span class="co"># Suppress iteration progress messages</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">silent =</span> <span class="dv">2</span>        <span class="co"># Suppress Stan compilation messages</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Wrapper for Bayesian Beta GLMM</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description A helper function to fit a beta mixed-effects model for proportional</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">#'   data (i.e., values between 0 and 1), used here for Area Under the Curve.</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param model_formula A brms formula object.</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param dataset The dataframe containing the variables in the formula.</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param file_path Optional string to save the fitted model object.</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A fitted brms model object.</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>beta_brm <span class="ot">&lt;-</span> <span class="cf">function</span>(model_formula, dataset, <span class="at">file_path =</span> <span class="cn">NULL</span>) {</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> model_formula, </span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">Beta</span>(), <span class="co"># Specifies a beta distribution for proportional outcomes</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dataset, </span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set priors as described in the paper</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> <span class="fu">c</span>(</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">100</span><span class="sc">^</span><span class="dv">100</span>), <span class="at">class =</span> Intercept), </span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">2.5</span>), <span class="at">class =</span> sd)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">2000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">backend =</span> <span class="st">"cmdstanr"</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.95</span>, <span class="at">max_treedepth =</span> <span class="dv">10</span>), </span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> file_path,</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span>, <span class="at">silent =</span> <span class="dv">2</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Summarize a brms Model Output</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description A function to create a clean summary table from a brms model, </span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="co">#'   calculating the median, 95% Highest Density Interval (HDI), and the </span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="co">#'   Probability of Direction (pd) for each parameter.</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param brm_model A fitted brms model object.</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param param_names Optional vector of strings to rename the parameters for clarity.</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A formatted dataframe summarizing the model's posterior distributions.</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>summarize_brm_model <span class="ot">&lt;-</span> <span class="cf">function</span>(brm_model, <span class="at">param_names =</span> <span class="cn">NULL</span>) {</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Suppress warnings from internal steps of the pipe</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressWarnings</span>({</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    summary_df <span class="ot">&lt;-</span> brm_model <span class="sc">|&gt;</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Extract posterior draws for all regression coefficients (`b_...`)</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gather_draws</span>(<span class="st">`</span><span class="at">b_.*</span><span class="st">`</span>, <span class="at">regex =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.variable, .value) <span class="sc">|&gt;</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Group by parameter to summarize each one</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(.variable) <span class="sc">|&gt;</span> </span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate Probability of Direction (pd), a Bayesian analog to p-value</span></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">pd =</span> <span class="fu">ecdf</span>(.value)(<span class="dv">0</span>),</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">pd =</span> <span class="fu">ifelse</span>(pd <span class="sc">&gt;=</span> <span class="fl">0.5</span>, pd, <span class="dv">1</span> <span class="sc">-</span> pd),</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">significance =</span> <span class="fu">ifelse</span>(pd <span class="sc">&gt;=</span> <span class="fl">0.975</span>, <span class="st">"*"</span>, <span class="st">" "</span>)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span> </span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Group again to collapse draws into a summary</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(.variable, pd, significance) <span class="sc">|&gt;</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate the posterior median and 95% Highest Density Interval</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>      <span class="fu">median_qi</span>() <span class="sc">|&gt;</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(.variable, .value, .lower, .upper, pd, significance) <span class="sc">|&gt;</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Clean up parameter names for the final table</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        <span class="at">.variable =</span> <span class="fu">str_replace</span>(.variable, <span class="st">"b_"</span>, <span class="st">""</span>),</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        <span class="at">.variable =</span> <span class="fu">str_replace</span>(.variable, <span class="st">"_c"</span>, <span class="st">""</span>)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Format all numeric columns to three decimal places</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">sprintf</span>(<span class="st">"%.3f"</span>, .))) <span class="sc">|&gt;</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Rename columns for the final presentation</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(<span class="fu">c</span>(<span class="st">"Parameter"</span>, <span class="st">"Median"</span>, <span class="st">"CI_lower"</span>, <span class="st">"CI_upper"</span>, <span class="st">"pd"</span>, <span class="st">"sig"</span>))</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If custom parameter names are provided, apply them</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(param_names)) {</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    summary_df<span class="sc">$</span>Parameter <span class="ot">&lt;-</span> param_names</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">as.data.frame</span>(summary_df))</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Calculate Area Under the Curve</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description Calculates the area under a curve using the trapezoidal rule.</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="co">#'   Used to derive the Area under the Curve (AuC) measure of delay discounting.</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x A numeric vector of x-coordinates (e.g., delays).</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param y A numeric vector of y-coordinates (e.g., subjective values).</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A single numeric value representing the area under the curve.</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>calculate_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The formula sums the areas of trapezoids formed by adjacent points</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">diff</span>(x) <span class="sc">*</span> (y[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> y[<span class="sc">-</span><span class="fu">length</span>(y)])) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-processing">Data Processing</h2>
<p>This section details the entire data processing pipeline. Raw data from two Excel sheets are loaded, cleaned, and merged. From this cleaned dataset, we derive:</p>
<ol type="1">
<li><strong>Group-level dataframes</strong> for visualization and quality checks.</li>
<li><strong>Individual-level dataframes</strong> containing the primary discounting scores (<code>AuC</code> and <code>Num_Choice</code>).</li>
<li><strong>Model-specific dataframes</strong> with centered predictor variables for the hypothesis-testing regressions.</li>
<li>A <strong>composite z-score dataframe</strong> for analyzing the overall effect magnitude.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. DATA IMPORT AND PROCESSING ---</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This section loads the raw data, processes it into analysis-ready formats,</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and creates specific dataframes for each statistical model.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2.1 Load Raw Data ---</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the two datasets from the Excel file:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Monetary Choice Questionnaire (MCQ) data, in long format (one row per choice).</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Adjusting-Amount (Adj-Amt) data, in long format (one row per indifference point).</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The file path is relative to the project's root directory.</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>raw_mcq_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"Data_AgeIncome.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>raw_adj_amt_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"Data_AgeIncome.xlsx"</span>, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2.2 Process Behavioral Data ---</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a lookup table with the fixed parameters for each of the 27 MCQ items.</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># This avoids hardcoding values and makes the code cleaner and less error-prone.</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>mcq_item_parameters <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q_ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">27</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 'k' is the discounting parameter associated with each choice item</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="fu">c</span>(<span class="fl">0.00016</span>, <span class="fl">0.00600</span>, <span class="fl">0.00600</span>, <span class="fl">0.25000</span>, <span class="fl">0.04100</span>, <span class="fl">0.00040</span>, <span class="fl">0.10000</span>, </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.10000</span>, <span class="fl">0.00016</span>, <span class="fl">0.00600</span>, <span class="fl">0.25000</span>, <span class="fl">0.00100</span>, <span class="fl">0.00016</span>, <span class="fl">0.04100</span>, </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.00250</span>, <span class="fl">0.00250</span>, <span class="fl">0.00040</span>, <span class="fl">0.01600</span>, <span class="fl">0.10000</span>, <span class="fl">0.00040</span>, <span class="fl">0.01600</span>, </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.00250</span>, <span class="fl">0.04100</span>, <span class="fl">0.00100</span>, <span class="fl">0.01600</span>, <span class="fl">0.00100</span>, <span class="fl">0.25000</span>),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Amount block for the larger, delayed reward</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amount =</span> <span class="fu">c</span>(<span class="st">"$55"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>, <span class="st">"$80"</span>, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>             <span class="st">"$55"</span>, <span class="st">"$30"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>, <span class="st">"$80"</span>, <span class="st">"$55"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>             <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>, <span class="st">"$30"</span>, <span class="st">"$80"</span>, <span class="st">"$55"</span>, <span class="st">"$80"</span>, <span class="st">"$30"</span>, <span class="st">"$55"</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the parameters to the raw MCQ data</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>mcq_data_with_params <span class="ot">&lt;-</span> raw_mcq_data <span class="sc">|&gt;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mcq_item_parameters, <span class="at">by =</span> <span class="st">"Q_ID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amount =</span> <span class="fu">factor</span>(Amount, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"$80"</span>, <span class="st">"$55"</span>, <span class="st">"$30"</span>))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate participant-level summary for the Adj-Amt procedure.</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co"># The primary measure is Area under the Curve (AuC).</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>adj_amt_by_participant <span class="ot">&lt;-</span> raw_adj_amt_data <span class="sc">|&gt;</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude the 730-day delay, which was only used for the $500 amount,</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to make AuC comparable across all amount conditions.</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Delay <span class="sc">!=</span> <span class="dv">730</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Amount) <span class="sc">|&gt;</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use our custom function to calculate AuC</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">auc =</span> <span class="fu">calculate_auc</span>(<span class="at">x =</span> Delay <span class="sc">/</span> <span class="fu">max</span>(Delay), <span class="at">y =</span> RSV),</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate participant-level summary for the MCQ procedure.</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co"># The primary measure is the number of times the delayed option was chosen.</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>mcq_by_participant <span class="ot">&lt;-</span> mcq_data_with_params <span class="sc">|&gt;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Amount) <span class="sc">|&gt;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_delayed_choices =</span> <span class="fu">sum</span>(Choice),</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2.3 Create Demographics and Final Analysis Dataframes ---</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a master demographics file by taking distinct participants from one of the raw files.</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>demographics_data <span class="ot">&lt;-</span> <span class="fu">distinct</span>(raw_adj_amt_data, ID, Group, Age, Gender, Education, HADS) <span class="sc">|&gt;</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create binary predictor variables for the regression models.</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 0 = reference group.</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="fu">ifelse</span>(Group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">0</span>, <span class="dv">1</span>),      <span class="co"># 0=Younger, 1=Older</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_group =</span> <span class="fu">ifelse</span>(Group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="dv">0</span>, <span class="dv">1</span>),    <span class="co"># 0=Lower, 1=Higher</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">education_group =</span> <span class="fu">ifelse</span>(Education <span class="sc">&lt;=</span> <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="co"># 0=Below College, 1=College+</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert HADS score from character to numeric, coercing "NA" strings to NA</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">hads_score =</span> <span class="fu">as.numeric</span>(HADS)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the demographics data to the processed behavioral data.</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>mcq_analysis_data <span class="ot">&lt;-</span> mcq_by_participant <span class="sc">|&gt;</span> <span class="fu">left_join</span>(demographics_data, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>adj_amt_analysis_data <span class="ot">&lt;-</span> adj_amt_by_participant <span class="sc">|&gt;</span> <span class="fu">left_join</span>(demographics_data, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2.4 Prepare Model-Specific Dataframes with Centered Variables ---</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Create separate dataframes for each of the three models specified in the paper.</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="co"># This is necessary because covariates are added sequentially, and participants with</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="co"># missing data for a new covariate (e.g., HADS) must be excluded.</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictors are grand-mean centered to improve model convergence and make the </span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="co"># intercept interpretable.</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1: Age x Income interaction</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>mcq_model1_df <span class="ot">&lt;-</span> mcq_analysis_data <span class="sc">|&gt;</span> </span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Amount <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"$30"</span>, <span class="st">"$80"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group_c =</span> age_group <span class="sc">-</span> <span class="fu">mean</span>(age_group), </span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_group_c =</span> income_group <span class="sc">-</span> <span class="fu">mean</span>(income_group)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>adj_amt_model1_df <span class="ot">&lt;-</span> adj_amt_analysis_data <span class="sc">|&gt;</span> </span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Amount <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">80</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group_c =</span> age_group <span class="sc">-</span> <span class="fu">mean</span>(age_group), </span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_group_c =</span> income_group <span class="sc">-</span> <span class="fu">mean</span>(income_group)</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2: Add Education and Gender as covariates</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>mcq_model2_df <span class="ot">&lt;-</span> mcq_analysis_data <span class="sc">|&gt;</span> </span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Amount <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"$30"</span>, <span class="st">"$80"</span>), <span class="sc">!</span><span class="fu">is.na</span>(education_group)) <span class="sc">|&gt;</span> </span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(age_group, income_group, Gender, education_group), </span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> . <span class="sc">-</span> <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">"{.col}_c"</span>))</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>adj_amt_model2_df <span class="ot">&lt;-</span> adj_amt_analysis_data <span class="sc">|&gt;</span> </span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Amount <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">80</span>), <span class="sc">!</span><span class="fu">is.na</span>(education_group)) <span class="sc">|&gt;</span> </span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(age_group, income_group, Gender, education_group), </span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> . <span class="sc">-</span> <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">"{.col}_c"</span>))</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3: Add HADS (psychological distress) as a covariate</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>mcq_model3_df <span class="ot">&lt;-</span> mcq_analysis_data <span class="sc">|&gt;</span> </span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Amount <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"$30"</span>, <span class="st">"$80"</span>), <span class="sc">!</span><span class="fu">is.na</span>(education_group), <span class="sc">!</span><span class="fu">is.na</span>(hads_score)) <span class="sc">|&gt;</span> </span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(age_group, income_group, Gender, education_group), </span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span> . <span class="sc">-</span> <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">"{.col}_c"</span>),</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardize HADS score by dividing by 2*SD as in Gelman (2008)</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">hads_score_c =</span> (hads_score <span class="sc">-</span> <span class="fu">mean</span>(hads_score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sd</span>(hads_score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>adj_amt_model3_df <span class="ot">&lt;-</span> adj_amt_analysis_data <span class="sc">|&gt;</span> </span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Amount <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">80</span>), <span class="sc">!</span><span class="fu">is.na</span>(education_group), <span class="sc">!</span><span class="fu">is.na</span>(hads_score)) <span class="sc">|&gt;</span> </span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(age_group, income_group, Gender, education_group), </span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span> . <span class="sc">-</span> <span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">"{.col}_c"</span>),</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">hads_score_c =</span> (hads_score <span class="sc">-</span> <span class="fu">mean</span>(hads_score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">sd</span>(hads_score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2.5 Create the Composite z-Score DataFrame ---</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a><span class="co"># This dataframe combines the two behavioral measures (MCQ choices and Adj-Amt AuC)</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="co"># into a single, standardized score for each participant. This provides a robust,</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a><span class="co"># holistic measure of discounting for examining the main hypotheses.</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Isolate the two key measures for the common amounts ($30, $80)</span></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>mcq_for_composite <span class="ot">&lt;-</span> mcq_analysis_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(Amount <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"$30"</span>, <span class="st">"$80"</span>))</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>adj_amt_for_composite <span class="ot">&lt;-</span> adj_amt_analysis_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(Amount <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">80</span>))</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine, calculate z-scores, and average them for each participant</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>composite_score_data <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">arrange</span>(mcq_for_composite, ID, <span class="fu">desc</span>(Amount)),</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>           ID, age_group, income_group, Age, num_delayed_choices), </span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(adj_amt_for_composite, auc)</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Standardize each measure to have a mean of 0 and SD of 1</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">mcq_z =</span> (num_delayed_choices <span class="sc">-</span> <span class="fu">mean</span>(num_delayed_choices)) <span class="sc">/</span> <span class="fu">sd</span>(num_delayed_choices),</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">adj_amt_z =</span> (auc <span class="sc">-</span> <span class="fu">mean</span>(auc)) <span class="sc">/</span> <span class="fu">sd</span>(auc)</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape data to long format to easily calculate the average z-score</span></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(mcq_z, adj_amt_z),</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"procedure"</span>,</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"z_score"</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, age_group, income_group, Age) <span class="sc">|&gt;</span> </span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the mean z-score for each participant</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_z_score =</span> <span class="fu">mean</span>(z_score), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add centered predictors for the final analysis</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_group_c =</span> age_group <span class="sc">-</span> <span class="fu">mean</span>(age_group),</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_group_c =</span> income_group <span class="sc">-</span> <span class="fu">mean</span>(income_group),</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_c =</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(Age))</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="data-quality-reliability-checks" class="level2">
<h2 class="anchored" data-anchor-id="data-quality-reliability-checks">3. Data Quality &amp; Reliability Checks</h2>
<p>Before testing the primary hypotheses, this section replicates the initial analyses from the paper that establish the quality and internal consistency of the behavioral data. These checks confirm two key points:</p>
<ol type="1">
<li><strong>Validity</strong>: At the group level, the data conforms well to established mathematical models of discounting (logistic growth for MCQ data, hyperboloid for Adj-Amt data), as indicated by high <span class="math inline">\(R^2\)</span> values. This confirms that participants’ choices were systematic and not random.</li>
<li><strong>Reliability</strong>: At the individual level, participants’ discounting behavior is consistent across different reward amounts within the same task. The high positive correlations demonstrate that individuals who discounted small rewards steeply also tended to discount large rewards steeply.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3.1 Group-Level Model Fit Assessment ---</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The following analyses assess how well standard mathematical models of choice</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># describe the aggregated data from each of the four participant groups.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># High R-squared values indicate that the data is well-behaved and systematic.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a logistic growth model to the MCQ choice proportions for each group and amount.</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"--- MCQ: R-squared for Group-Level Logistic Growth Fits ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- MCQ: R-squared for Group-Level Logistic Growth Fits ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mcq_group_fits <span class="ot">&lt;-</span> mcq_data_with_params <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create required variables for the group-level analysis</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_k =</span> <span class="fu">log</span>(k),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_label =</span> <span class="fu">factor</span>(Group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Younger, Lower-Income"</span>, <span class="st">"Older, Lower-Income"</span>, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Younger, Higher-Income"</span>, <span class="st">"Older, Higher-Income"</span>))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_label, Amount, log_k) <span class="sc">|&gt;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop_delayed =</span> <span class="fu">mean</span>(Choice), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_label, Amount) <span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For each group, calculate the R-squared from a non-linear least squares model</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">R2 =</span> modelr<span class="sc">::</span><span class="fu">rsquare</span>(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nlsLM</span>(prop_delayed <span class="sc">~</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>(log_k <span class="sc">-</span> a) <span class="sc">*</span> r)), </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> ., <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="sc">-</span><span class="dv">4</span>, <span class="at">r =</span> <span class="dv">1</span>)),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> .</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(R2) <span class="sc">|&gt;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group_label, <span class="at">values_from =</span> R2)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.data.frame</span>(mcq_group_fits), <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Amount Younger, Lower-Income Older, Lower-Income Younger, Higher-Income
1    $80                 0.995               0.994                  0.994
2    $55                 0.991               0.996                  0.987
3    $30                 0.994               0.997                  0.994
  Older, Higher-Income
1                0.986
2                0.991
3                0.996</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a hyperboloid model to the Adj-Amt relative subjective values.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Adj-Amt: R-squared for Group-Level Hyperboloid Fits ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Adj-Amt: R-squared for Group-Level Hyperboloid Fits ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>adj_amt_group_fits <span class="ot">&lt;-</span> raw_adj_amt_data <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_label =</span> <span class="fu">factor</span>(Group, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Younger, Lower-Income"</span>, <span class="st">"Older, Lower-Income"</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Younger, Higher-Income"</span>, <span class="st">"Older, Higher-Income"</span>)),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amount =</span> <span class="fu">factor</span>(Amount)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_label, Amount, Delay) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_rsv =</span> <span class="fu">mean</span>(RSV), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_label, Amount) <span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">R2 =</span> modelr<span class="sc">::</span><span class="fu">rsquare</span>(</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">nlsLM</span>(mean_rsv <span class="sc">~</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> k <span class="sc">*</span> Delay)<span class="sc">^</span>s, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> ., <span class="at">start =</span> <span class="fu">list</span>(<span class="at">k =</span> .<span class="dv">1</span>, <span class="at">s =</span> <span class="dv">1</span>)),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> .</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(R2) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> group_label, <span class="at">values_from =</span> R2)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">as.data.frame</span>(adj_amt_group_fits), <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Amount Younger, Lower-Income Older, Lower-Income Younger, Higher-Income
1     30                 0.997               0.944                  0.997
2     80                 0.990               0.985                  0.988
3    500                 0.976               0.980                  0.967
  Older, Higher-Income
1                0.967
2                0.952
3                0.952</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3.2 Within-Procedure Reliability (Alternate-Forms Reliability) ---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># These analyses check if participants' discounting rates are consistent across</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># different reward amounts within the same procedure. High correlations indicate</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># that the measures are reliable.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlations for the number of delayed choices in the MCQ task.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MCQ: Within-Procedure Correlations (Number of Delayed Choices) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MCQ: Within-Procedure Correlations (Number of Delayed Choices) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mcq_reliability_cor <span class="ot">&lt;-</span> mcq_by_participant <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Amount, <span class="at">values_from =</span> num_delayed_choices) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">$30</span><span class="st">`</span>, <span class="st">`</span><span class="at">$55</span><span class="st">`</span>, <span class="st">`</span><span class="at">$80</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mcq_reliability_cor, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     $30  $55  $80
$30 1.00 0.92 0.90
$55 0.92 1.00 0.94
$80 0.90 0.94 1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlations for the Area under the Curve in the Adj-Amt task.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Adj-Amt: Within-Procedure Correlations (AuC) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Adj-Amt: Within-Procedure Correlations (AuC) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>adj_amt_reliability_cor <span class="ot">&lt;-</span> adj_amt_by_participant <span class="sc">|&gt;</span>  </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Amount, <span class="at">values_from =</span> auc) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select and rename for a clean correlation matrix</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"$30"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">30</span><span class="st">`</span>, <span class="st">"$80"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">80</span><span class="st">`</span>, <span class="st">"$500"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">500</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(adj_amt_reliability_cor, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      $30  $80 $500
$30  1.00 0.91 0.77
$80  0.91 1.00 0.84
$500 0.77 0.84 1.00</code></pre>
</div>
</div>
<hr>
</section>
<section id="hypothesis-testing-effects-of-age-on-discounting" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-testing-effects-of-age-on-discounting">4. Hypothesis Testing: Effects of Age on Discounting</h2>
<p>This section replicates the core analyses that test the <strong>buffering hypothesis</strong>. The key prediction is that <strong>age will be associated with more patient decision-making (less discounting), but only for the low-income group</strong>. No significant age effect is expected for the high-income group, who are not experiencing the same level of financial scarcity.</p>
<p>To test this, a series of Bayesian multilevel models are run separately for each income group. The analysis proceeds in three stages, corresponding to <strong>Table 2</strong> in the publication:</p>
<ol type="1">
<li><strong>Model 1</strong>: A baseline model testing the direct effect of age on discounting.</li>
<li><strong>Model 2</strong>: An expanded model that adds demographic covariates (education, gender) to test if the age effect is robust.</li>
<li><strong>Model 3</strong>: The full model, which adds psychological distress (HADS score) as a predictor. The buffering hypothesis predicts that controlling for distress should eliminate the age effect, suggesting distress is a key mechanism.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4.1 Model 1: Baseline Effect of Age ---</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the main prediction: is there an effect of age on discounting</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for each income group, before controlling for other factors?</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"--- MODEL 1: AGE EFFECTS (LOW-INCOME GROUP) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- MODEL 1: AGE EFFECTS (LOW-INCOME GROUP) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Low-Income Group ---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>mcq_age_low_inc_m1 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> age_group_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model1_df, income_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_age_low_inc_m1"</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_age_low_inc_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Parameter Median CI_lower CI_upper    pd sig
1 age_group  0.384    0.076    0.693 0.992   *
2 Intercept -0.093   -0.256    0.068 0.879    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>adj_amt_age_low_inc_m1 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> age_group_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model1_df, income_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_age_low_inc_m1"</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_age_low_inc_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Parameter Median CI_lower CI_upper    pd sig
1 age_group  0.472    0.126    0.845 0.998   *
2 Intercept  0.525    0.347    0.703 1.000   *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MODEL 1: AGE EFFECTS (HIGH-INCOME GROUP) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MODEL 1: AGE EFFECTS (HIGH-INCOME GROUP) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- High-Income Group ---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>mcq_age_high_inc_m1 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> age_group_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model1_df, income_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_age_high_inc_m1"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_age_high_inc_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Parameter Median CI_lower CI_upper    pd sig
1 age_group  0.035   -0.266    0.328 0.592    
2 Intercept  0.033   -0.118    0.184 0.667    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>adj_amt_age_high_inc_m1 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> age_group_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model1_df, income_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_age_high_inc_m1"</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_age_high_inc_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Parameter Median CI_lower CI_upper    pd sig
1 age_group  0.078   -0.256    0.427 0.674    
2 Intercept  0.767    0.599    0.936 1.000   *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4.2 Model 2: Controlling for Demographics ---</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test if the age effect persists after accounting for education and gender.</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- MODEL 2: AGE EFFECTS CONTROLLING FOR DEMOGRAPHICS (LOW-INCOME GROUP) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- MODEL 2: AGE EFFECTS CONTROLLING FOR DEMOGRAPHICS (LOW-INCOME GROUP) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Low-Income Group ---</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>mcq_age_low_inc_m2 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> age_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model2_df, income_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_age_low_inc_m2"</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_age_low_inc_m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1       age_group  0.329    0.019    0.637 0.983   *
2 education_group  0.338    0.020    0.646 0.983   *
3          Gender -0.208   -0.522    0.099 0.909    
4       Intercept -0.028   -0.193    0.138 0.625    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>adj_amt_age_low_inc_m2 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> age_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model2_df, income_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_age_low_inc_m2"</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_age_low_inc_m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1       age_group  0.377    0.030    0.723 0.983   *
2 education_group  0.510    0.172    0.854 0.998   *
3          Gender -0.403   -0.754   -0.066 0.990   *
4       Intercept  0.625    0.430    0.813 1.000   *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MODEL 2: AGE EFFECTS CONTROLLING FOR DEMOGRAPHICS (HIGH-INCOME GROUP) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MODEL 2: AGE EFFECTS CONTROLLING FOR DEMOGRAPHICS (HIGH-INCOME GROUP) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- High-Income Group ---</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>mcq_age_high_inc_m2 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> age_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model2_df, income_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_age_high_inc_m2"</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_age_high_inc_m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1       age_group  0.016   -0.293    0.319 0.540    
2 education_group  0.455    0.039    0.880 0.984   *
3          Gender  0.128   -0.191    0.441 0.791    
4       Intercept -0.050   -0.230    0.116 0.722    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>adj_amt_age_high_inc_m2 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> age_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model2_df, income_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_age_high_inc_m2"</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_age_high_inc_m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1       age_group  0.042   -0.299    0.368 0.597    
2 education_group  0.527    0.057    1.003 0.986   *
3          Gender  0.150   -0.191    0.496 0.796    
4       Intercept  0.664    0.474    0.854 1.000   *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 4.3 Model 3: Controlling for Psychological Distress ---</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test if the age effect is statistically mediated by distress. If the age</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficient becomes non-significant here, it supports the buffering hypothesis.</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- MODEL 3: AGE EFFECTS CONTROLLING FOR DEMOGRAPHICS &amp; DISTRESS (LOW-INCOME GROUP) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- MODEL 3: AGE EFFECTS CONTROLLING FOR DEMOGRAPHICS &amp; DISTRESS (LOW-INCOME GROUP) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Low-Income Group ---</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mcq_age_low_inc_m3 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> age_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> hads_score_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model3_df, income_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_age_low_inc_m3"</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_age_low_inc_m3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1       age_group  0.236   -0.108    0.578 0.914    
2 education_group  0.318   -0.017    0.643 0.969    
3          Gender -0.189   -0.508    0.125 0.888    
4      hads_score -0.239   -0.540    0.075 0.932    
5       Intercept  0.003   -0.168    0.180 0.516    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>adj_amt_age_low_inc_m3 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> age_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> hads_score_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model3_df, income_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_age_low_inc_m3"</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_age_low_inc_m3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1       age_group  0.264   -0.118    0.648 0.909    
2 education_group  0.502    0.144    0.866 0.996   *
3          Gender -0.377   -0.727   -0.003 0.976   *
4      hads_score -0.287   -0.618    0.072 0.943    
5       Intercept  0.666    0.477    0.859 1.000   *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MODEL 3: AGE EFFECTS CONTROLLING FOR DEMOGRAPHICS &amp; DISTRESS (HIGH-INCOME GROUP) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MODEL 3: AGE EFFECTS CONTROLLING FOR DEMOGRAPHICS &amp; DISTRESS (HIGH-INCOME GROUP) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- High-Income Group ---</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>mcq_age_high_inc_m3 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> age_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> hads_score_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model3_df, income_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_age_high_inc_m3"</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_age_high_inc_m3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1       age_group  0.095   -0.211    0.397 0.736    
2 education_group  0.425    0.016    0.857 0.980   *
3          Gender  0.137   -0.179    0.437 0.810    
4      hads_score  0.237   -0.112    0.588 0.908    
5       Intercept -0.042   -0.213    0.137 0.676    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>adj_amt_age_high_inc_m3 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> age_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> hads_score_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model3_df, income_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_age_high_inc_m3"</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_age_high_inc_m3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1       age_group  0.079   -0.266    0.423 0.676    
2 education_group  0.526    0.035    1.002 0.981   *
3          Gender  0.149   -0.207    0.499 0.792    
4      hads_score  0.223   -0.188    0.620 0.865    
5       Intercept  0.682    0.485    0.881 1.000   *</code></pre>
</div>
</div>
<hr>
</section>
<section id="hypothesis-testing-effects-of-income-on-discounting" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-testing-effects-of-income-on-discounting">5. Hypothesis Testing: Effects of Income on Discounting</h2>
<p>This section replicates the complementary analyses that provide a second test of the <strong>buffering hypothesis</strong>. The prediction here is the inverse of the previous section: <strong>higher income will be associated with more patient decision-making, but only for the younger group</strong>. Because older adults are already “buffered” by their greater emotional stability, their decision-making should be less influenced by income differences.</p>
<p>To test this, models are run separately for each age group to examine the effect of income. The analysis proceeds in two stages, corresponding to <strong>Table 3</strong> in the publication:</p>
<ol type="1">
<li><strong>Model 1</strong>: A baseline model testing the direct effect of income on discounting.</li>
<li><strong>Model 2</strong>: An expanded model that adds demographic covariates (education, gender) to test the robustness of the income effect.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5.1 Model 1: Baseline Effect of Income ---</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the main prediction: does higher income lead to less discounting,</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and is this effect present only for younger adults?</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"--- MODEL 1: INCOME EFFECTS (YOUNGER ADULTS) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- MODEL 1: INCOME EFFECTS (YOUNGER ADULTS) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Younger Adults ---</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>mcq_income_younger_m1 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> income_group_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model1_df, age_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_income_younger_m1"</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_income_younger_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Parameter Median CI_lower CI_upper    pd sig
1 income_group  0.299   -0.009    0.613 0.972    
2    Intercept -0.127   -0.285    0.031 0.944    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>adj_amt_income_younger_m1 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> income_group_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model1_df, age_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_income_younger_m1"</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_income_younger_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Parameter Median CI_lower CI_upper    pd sig
1 income_group  0.428    0.087    0.783 0.994   *
2    Intercept  0.508    0.336    0.688 1.000   *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MODEL 1: INCOME EFFECTS (OLDER ADULTS) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MODEL 1: INCOME EFFECTS (OLDER ADULTS) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Older Adults ---</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>mcq_income_older_m1 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> income_group_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model1_df, age_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_income_older_m1"</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_income_older_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Parameter Median CI_lower CI_upper    pd sig
1 income_group -0.058   -0.362    0.241 0.646    
2    Intercept  0.078   -0.068    0.232 0.853    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>adj_amt_income_older_m1 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> income_group_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model1_df, age_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_income_older_m1"</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_income_older_m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Parameter Median CI_lower CI_upper    pd sig
1 income_group  0.036   -0.310    0.386 0.581    
2    Intercept  0.799    0.620    0.980 1.000   *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5.2 Model 2: Controlling for Demographics ---</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Test if the income effect persists after accounting for education and gender.</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- MODEL 2: INCOME EFFECTS CONTROLLING FOR DEMOGRAPHICS (YOUNGER ADULTS) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- MODEL 2: INCOME EFFECTS CONTROLLING FOR DEMOGRAPHICS (YOUNGER ADULTS) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Younger Adults ---</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>mcq_income_younger_m2 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> income_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model2_df, age_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_income_younger_m2"</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_income_younger_m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1 education_group  0.477    0.119    0.831 0.996   *
2          Gender -0.101   -0.417    0.220 0.742    
3    income_group  0.102   -0.233    0.443 0.722    
4       Intercept -0.098   -0.254    0.058 0.894    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>adj_amt_income_younger_m2 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> income_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model2_df, age_group <span class="sc">==</span> <span class="dv">0</span>),</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_income_younger_m2"</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_income_younger_m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1 education_group  0.521    0.127    0.908 0.994   *
2          Gender -0.091   -0.430    0.254 0.700    
3    income_group  0.229   -0.159    0.617 0.875    
4       Intercept  0.543    0.378    0.707 1.000   *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- MODEL 2: INCOME EFFECTS CONTROLLING FOR DEMOGRAPHICS (OLDER ADULTS) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- MODEL 2: INCOME EFFECTS CONTROLLING FOR DEMOGRAPHICS (OLDER ADULTS) ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Older Adults ---</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>mcq_income_older_m2 <span class="ot">&lt;-</span> <span class="fu">binomial_brm</span>(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(num_delayed_choices <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">9</span>) <span class="sc">~</span> income_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(mcq_model2_df, age_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/mcq_income_older_m2"</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(mcq_income_older_m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1 education_group  0.224   -0.135    0.582 0.887    
2          Gender -0.010   -0.327    0.312 0.527    
3    income_group -0.128   -0.452    0.202 0.771    
4       Intercept  0.071   -0.083    0.233 0.820    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>adj_amt_income_older_m2 <span class="ot">&lt;-</span> <span class="fu">beta_brm</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_formula =</span> <span class="fu">bf</span>(auc <span class="sc">~</span> income_group_c <span class="sc">+</span> education_group_c <span class="sc">+</span> Gender_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID)),</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dataset =</span> <span class="fu">subset</span>(adj_amt_model2_df, age_group <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">file_path =</span> <span class="st">"rds/adj_amt_income_older_m2"</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summarize_brm_model</span>(adj_amt_income_older_m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Parameter Median CI_lower CI_upper    pd sig
1 education_group  0.413    0.006    0.836 0.976   *
2          Gender -0.169   -0.521    0.184 0.821    
3    income_group -0.112   -0.498    0.259 0.711    
4       Intercept  0.776    0.595    0.952 1.000   *</code></pre>
</div>
</div>
<hr>
</section>
<section id="composite-score-analysis-effect-magnitudes" class="level2">
<h2 class="anchored" data-anchor-id="composite-score-analysis-effect-magnitudes">6. Composite Score Analysis &amp; Effect Magnitudes</h2>
<p>The final analyses use the composite z-score—a single, robust measure that combines data from both the MCQ and Adj-Amt procedures—to provide a holistic test of the buffering hypothesis.</p>
<p>First, we replicate the focused correlation tests from the paper. As predicted, we expect to find a significant positive correlation between age and financial patience (higher z-score) <strong>only in the low-income group</strong>. Conversely, we expect a significant positive correlation between income and financial patience <strong>only in the younger group</strong>.</p>
<p>Second, we quantify the magnitude of these effects using linear regression. This moves beyond statistical significance to understand the practical size of the age effect among low-income individuals, corresponding to the final analyses in the publication’s “Discussion” section.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6.1 Focused Correlation Tests with Composite Score ---</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the composite z-score to perform the two key hypothesis tests in a </span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># single, tidy analysis.</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 1: Correlation between Age and Discounting within each Income Group</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"--- Correlation of Age Group with Discounting z-score ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--- Correlation of Age Group with Discounting z-score ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>age_correlations <span class="ot">&lt;-</span> composite_score_data <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(income_group) <span class="sc">|&gt;</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">cor.test</span>(mean_z_score, age_group))) <span class="sc">|&gt;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income_group =</span> <span class="fu">ifelse</span>(income_group <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Low-Income"</span>, <span class="st">"High-Income"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Group =</span> income_group, <span class="at">Correlation =</span> estimate, <span class="at">p_value =</span> p.value)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(age_correlations, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  Group       Correlation p_value
  &lt;chr&gt;             &lt;dbl&gt;   &lt;dbl&gt;
1 Low-Income       0.202  0.00716
2 High-Income      0.0411 0.581  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 2: Correlation between Income and Discounting within each Age Group</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Correlation of Income Group with Discounting z-score ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Correlation of Income Group with Discounting z-score ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>income_correlations <span class="ot">&lt;-</span> composite_score_data <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">|&gt;</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">cor.test</span>(mean_z_score, income_group))) <span class="sc">|&gt;</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">ifelse</span>(age_group <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Younger"</span>, <span class="st">"Older"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Group =</span> age_group, <span class="at">Correlation =</span> estimate, <span class="at">p_value =</span> p.value)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(income_correlations, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  Group   Correlation p_value
  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;
1 Younger     0.163    0.0261
2 Older       0.00343  0.964 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 6.2 Quantifying Effect Magnitudes with Linear Models ---</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># These final models use the composite z-score to quantify the size of the </span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># observed effects.</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate and display the mean z-score for each of the four groups.</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">--- Mean Composite z-Score by Group ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

--- Mean Composite z-Score by Group ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>composite_score_data <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, income_group) <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_z_score =</span> <span class="fu">mean</span>(mean_z_score), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age_Group =</span> <span class="fu">ifelse</span>(age_group <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Younger"</span>, <span class="st">"Older"</span>),</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Income_Group =</span> <span class="fu">ifelse</span>(income_group <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Low-Income"</span>, <span class="st">"High-Income"</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Age_Group, Income_Group, mean_z_score) <span class="sc">|&gt;</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  Age_Group Income_Group mean_z_score
  &lt;chr&gt;     &lt;chr&gt;               &lt;dbl&gt;
1 Younger   Low-Income        -0.266 
2 Younger   High-Income        0.0425
3 Older     Low-Income         0.112 
4 Older     High-Income        0.118 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a full linear model to test for an interaction between age and income.</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A significant interaction confirms that the effect of age depends on income level.</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Full Model: z_score ~ Age * Income ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Full Model: z_score ~ Age * Income ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>full_interaction_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mean_z_score <span class="sc">~</span> age_group_c <span class="sc">*</span> income_group_c, </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> composite_score_data)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_interaction_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mean_z_score ~ age_group_c * income_group_c, data = composite_score_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.4354 -0.6807  0.0689  0.7513  1.9832 

Coefficients:
                           Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)                -0.00141    0.04860  -0.029   0.9769  
age_group_c                 0.22360    0.09729   2.298   0.0221 *
income_group_c              0.16342    0.09722   1.681   0.0936 .
age_group_c:income_group_c -0.30196    0.19460  -1.552   0.1216  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9207 on 355 degrees of freedom
Multiple R-squared:  0.02841,   Adjusted R-squared:  0.0202 
F-statistic: 3.461 on 3 and 355 DF,  p-value: 0.01658</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, use continuous age (rather than the binary group) to estimate the</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># year-over-year change in discounting for each income group separately.</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Age as a Continuous Predictor of z-score ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Age as a Continuous Predictor of z-score ---</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the low-income group, we expect a significant positive slope.</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Low-Income Group:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Low-Income Group:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>low_income_age_slope <span class="ot">&lt;-</span> <span class="fu">lm</span>(mean_z_score <span class="sc">~</span> Age, </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> <span class="fu">subset</span>(composite_score_data, income_group <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(low_income_age_slope)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mean_z_score ~ Age, data = subset(composite_score_data, 
    income_group == 0))

Residuals:
     Min       1Q   Median       3Q      Max 
-2.38424 -0.65772  0.00215  0.69787  2.01781 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) -0.713300   0.263980  -2.702  0.00757 **
Age          0.011474   0.004622   2.483  0.01399 * 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.923 on 174 degrees of freedom
Multiple R-squared:  0.03421,   Adjusted R-squared:  0.02866 
F-statistic: 6.163 on 1 and 174 DF,  p-value: 0.01399</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For the high-income group, we expect the slope to be non-significant.</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">High-Income Group:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
High-Income Group:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>high_income_age_slope <span class="ot">&lt;-</span> <span class="fu">lm</span>(mean_z_score <span class="sc">~</span> Age, </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> <span class="fu">subset</span>(composite_score_data, income_group <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(high_income_age_slope)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mean_z_score ~ Age, data = subset(composite_score_data, 
    income_group == 1))

Residuals:
     Min       1Q   Median       3Q      Max 
-2.44436 -0.65847  0.07954  0.78691  1.69228 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.099422   0.272667  -0.365    0.716
Age          0.003282   0.004884   0.672    0.502

Residual standard error: 0.9211 on 181 degrees of freedom
Multiple R-squared:  0.002489,  Adjusted R-squared:  -0.003022 
F-statistic: 0.4516 on 1 and 181 DF,  p-value: 0.5024</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>